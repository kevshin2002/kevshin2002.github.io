(self.webpackChunkkevshin2002=self.webpackChunkkevshin2002||[]).push([[9864],{8294:(e,n,a)=>{e.exports={src:{srcSet:a.p+"assets/ideal-img/costmap.4abd661.407.jpg 407w",images:[{path:a.p+"assets/ideal-img/costmap.4abd661.407.jpg",width:407,height:213}],src:a.p+"assets/ideal-img/costmap.4abd661.407.jpg",toString:function(){return a.p+"assets/ideal-img/costmap.4abd661.407.jpg"},placeholder:void 0,width:407,height:213},preSrc:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAFCAIAAADzBuo/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAApklEQVR4nAGbAGT/AODz/93x/tnu/eH0/9ru+oObnai0tMvS05Sjo4CYmQCSrrGguNG2xueYscOWs7Szv8Hy8vHx8fDp6eiSpKQAWnp7k6XMvbboe5CxZIiAyNHS4tvkwq3F3tHdorKyAJeytKO50LjI5ZiywKC6vY6joLSww4uQo3aJm4OWlwDg9P/e8v7Y7v3h9P/b7vqBmZlxiJB3kqZsgYmDm5wOuG0gTEFX4AAAAABJRU5ErkJggg=="}},8564:(e,n,a)=>{e.exports={src:{srcSet:a.p+"assets/ideal-img/Mapped.b607ca7.500.jpg 500w,"+a.p+"assets/ideal-img/Mapped.a6b9e37.1000.jpg 1000w,"+a.p+"assets/ideal-img/Mapped.e496c85.1182.jpg 1182w",images:[{path:a.p+"assets/ideal-img/Mapped.b607ca7.500.jpg",width:500,height:335},{path:a.p+"assets/ideal-img/Mapped.a6b9e37.1000.jpg",width:1e3,height:671},{path:a.p+"assets/ideal-img/Mapped.e496c85.1182.jpg",width:1182,height:793}],src:a.p+"assets/ideal-img/Mapped.b607ca7.500.jpg",toString:function(){return a.p+"assets/ideal-img/Mapped.b607ca7.500.jpg"},placeholder:void 0,width:500,height:335},preSrc:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAHCAIAAAC+zks0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA5ElEQVR4nAHZACb/AL/Fz8zS3c3T3r3DzLvByb3Cyri+x8PJ1NPZ5Lq+yADo6Obx8O7x7+9UVFM0NTM6OjkvLy6dnZzx8O/U09IA6uvr9PX28PDwU1lZZm9vjZCSTVdWmpub////29zcAOjo5/r5+PDw8GNlZaWkpb67vYSFh52enf///+Li4gDP3eTf7fbd5uxdYmKak5TEwMN1fX2en5/////j5OQA5+np9vj57+/wRkhIMjQ0QkJCIicnmpqa////4+PjAOfm5uvq6+bl5pyam4uJio6NjoeFhsG/wPLy8tTS00m0lGgXkslXAAAAAElFTkSuQmCC"}},4627:(e,n,a)=>{e.exports={src:{srcSet:a.p+"assets/ideal-img/map.8d53cda.500.jpg 500w,"+a.p+"assets/ideal-img/map.0b192e6.1000.jpg 1000w,"+a.p+"assets/ideal-img/map.dbf6436.1179.jpg 1179w",images:[{path:a.p+"assets/ideal-img/map.8d53cda.500.jpg",width:500,height:336},{path:a.p+"assets/ideal-img/map.0b192e6.1000.jpg",width:1e3,height:672},{path:a.p+"assets/ideal-img/map.dbf6436.1179.jpg",width:1179,height:792}],src:a.p+"assets/ideal-img/map.8d53cda.500.jpg",toString:function(){return a.p+"assets/ideal-img/map.8d53cda.500.jpg"},placeholder:void 0,width:500,height:336},preSrc:"data:image/jpeg;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAHCAIAAAC+zks0AAAACXBIWXMAAAsTAAALEwEAmpwYAAAA5ElEQVR4nAHZACb/AMHI08/W4NLY473Ezrm+yLrAybe9x8bN2Nng67m+xwDr6ef49vTw7excW1pDSkhOV1U1NjWYl5bx7+/My8oA0t/o2Obu3ejtfYeHh46OnaOke4SEp6+u////19fXAOfq7Ofr7e7y83+LiouMjKKam1BaWp6goP///93d3QDq6un09PP19vZ3hoVbbm1RW1omJyeamZn////d3d0A7e3t9vf28fHxZnV0OURDKisqFxYWlZWV////3d3dAObl5uzr7OXk5aSlpo+Oj5OSk4uLi8C/wPLx89DPz6Fsk81oXwH4AAAAAElFTkSuQmCC"}},8570:(e,n,a)=>{"use strict";a.r(n),a.d(n,{assets:()=>j,contentTitle:()=>g,default:()=>f,frontMatter:()=>x,metadata:()=>r,toc:()=>v});const r=JSON.parse('{"id":"Robotics/ROS2/nav2","title":"Nav2","description":"This has not been proof-read or modified for simpler reading yet.","source":"@site/docs/Robotics/ROS2/nav.mdx","sourceDirName":"Robotics/ROS2","slug":"/Robotics/ROS2/nav2","permalink":"/docs/Robotics/ROS2/nav2","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedAt":1734508800000,"sidebarPosition":1,"frontMatter":{"id":"nav2","title":"Nav2","hide_title":true,"sidebar_position":1,"last_update":{"date":"12/18/2024","author":"Kevin Shin"}},"sidebar":"noteSidebar","previous":{"title":"ROS2","permalink":"/docs/Robotics/ROS2/"},"next":{"title":"Perception","permalink":"/docs/Robotics/ROS2/perception"}}');var t=a(4848),i=a(8453),s=a(4627),o=a.n(s),l=a(8564),c=a.n(l);const d=a.p+"assets/medias/localization-ba3b88ba953cabc06080aaddf7e82f4f.mp4";var h=a(9489),_=a(7227);const m=a.p+"assets/medias/demo-1a40eff5b66c9b8d99e4117f6d3d9c8b.mp4";var p=a(8294),u=a.n(p);const x={id:"nav2",title:"Nav2",hide_title:!0,sidebar_position:1,last_update:{date:"12/18/2024",author:"Kevin Shin"}},g=void 0,j={},v=[{value:"Getting Started",id:"getting-started",level:2},{value:"Map",id:"map",level:2},{value:"Requirements",id:"requirements",level:3},{value:"Configuring Cartographer",id:"configuring-cartographer",level:3},{value:"Different Configurations",id:"different-configurations",level:3},{value:"Using Saved Map",id:"using-saved-map",level:3},{value:"Nav2 Lifecycle Manager",id:"nav2-lifecycle-manager",level:2},{value:"Lifecycle Manager",id:"lifecycle-manager",level:4},{value:"Localization",id:"localization",level:2},{value:"ROS2 Localization",id:"ros2-localization",level:3},{value:"For Python",id:"for-python",level:4},{value:"For C++",id:"for-c",level:4},{value:"Overall Filter Parameters",id:"overall-filter-parameters",level:4},{value:"Laser Model Parameters",id:"laser-model-parameters",level:4},{value:"Odometry Model Parameters",id:"odometry-model-parameters",level:4},{value:"Auto Localization",id:"auto-localization",level:3},{value:"Via YAML",id:"via-yaml",level:4},{value:"Via CLI",id:"via-cli",level:4},{value:"Global Localization",id:"global-localization",level:3},{value:"Path Planning",id:"path-planning",level:2},{value:"Mapping Environment",id:"mapping-environment",level:5},{value:"Path Planning",id:"path-planning-1",level:5},{value:"Planner",id:"planner",level:3},{value:"nav2_yaml",id:"nav2_yaml",level:5},{value:"Controller",id:"controller",level:3},{value:"controller_yaml",id:"controller_yaml",level:5},{value:"Navigation Controller",id:"navigation-controller",level:3},{value:"bt_navigator_yaml",id:"bt_navigator_yaml",level:5},{value:"Recoveries Server",id:"recoveries-server",level:3},{value:"recovery_yaml",id:"recovery_yaml",level:5},{value:"Demo",id:"demo",level:3},{value:"RVIZ2 Settings",id:"rviz2-settings",level:4},{value:"Navigation Goal via CLI",id:"navigation-goal-via-cli",level:4},{value:"Action",id:"action",level:5},{value:"Topic",id:"topic",level:5},{value:"ROS2 Node",id:"ros2-node",level:4},{value:"Obstacle Avoidance",id:"obstacle-avoidance",level:2},{value:"Costmaps",id:"costmaps",level:3},{value:"Global Costmaps",id:"global-costmaps",level:3},{value:"Global Costmap Obstacle Layers",id:"global-costmap-obstacle-layers",level:4},{value:"General Parameters",id:"general-parameters",level:4},{value:"Local Costmap",id:"local-costmap",level:3}];function b(e){const n={a:"a",admonition:"admonition",annotation:"annotation",code:"code",h2:"h2",h3:"h3",h4:"h4",h5:"h5",img:"img",li:"li",math:"math",mi:"mi",mo:"mo",mrow:"mrow",ol:"ol",p:"p",pre:"pre",semantics:"semantics",span:"span",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.admonition,{type:"danger",children:[(0,t.jsx)(n.p,{children:"This has not been proof-read or modified for simpler reading yet."}),(0,t.jsx)(n.p,{children:"12/23/24"})]}),"\n",(0,t.jsx)(n.h2,{id:"getting-started",children:"Getting Started"}),"\n",(0,t.jsxs)(n.p,{children:["These are my notes from the ROS2 Navigation course available on ",(0,t.jsx)(n.a,{href:"https://app.theconstruct.ai",children:"The Construct"}),". As this is a robotics note, you will need physical hardware components to follow along. Before each section though, I will list what is required before starting."]}),"\n",(0,t.jsx)(n.h2,{id:"map",children:"Map"}),"\n",(0,t.jsx)(n.p,{children:"A map is a representation of the environment that the robot is functioning in. It uses the map to localize and plan trajectories. Maps are implemented in ROS2 via an occupancy grid where in each ccell, specific values represent obstacles."}),"\n",(0,t.jsx)(n.h3,{id:"requirements",children:"Requirements"}),"\n",(0,t.jsx)(n.p,{children:"Before starting, we need a robot with LIDAR and Odometry. We also need to use SLAM for localizing. Available ones are cartographer and SLAM-Toolbox. This note uses cartographer as the learning curve is lower. It is notable that cartographer is no longer maintained, so the better software to use is SLAM-Toolbox."}),"\n",(0,t.jsx)(n.p,{children:"Cartographer is a system that provides real-time simultaneous localization and mapping (SLAM) in both 2D and 3D across multiple platforms and sensor configurations. Cartographer_ros is a ROS wrapper of cartographer so that we can integrate cartographer with ROS. This allows us to use prebuilt packages and only have to configure them."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://google-cartographer-ros.readthedocs.io/en/latest/_images/demo_2d.gif",alt:"cartographer_2d"})}),"\n",(0,t.jsx)(n.h3,{id:"configuring-cartographer",children:"Configuring Cartographer"}),"\n",(0,t.jsx)(n.p,{children:"We use a launch file because we can start multiple nodes and can also set a node-specific parameter while launching a node. These parameters can then be loaded from a YAML file or specified in the launch file."}),"\n",(0,t.jsxs)(n.p,{children:["To launch ",(0,t.jsx)(n.code,{children:"cartographer"}),", we need to launch two nodes:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-py",children:"import os\nfrom ament_index_python.packages import get_package_share_directory\n\ncartographer_config_dir = os.path.join(get_package_share_directory('cartographer_slam'), 'config')\n\nNode(\n    package='cartographer_ros',\n    executable='cartographer_node',\n    name='cartographer_node',\n    output='screen',\n    parameters=[{'use_sim_time': True}], # boolean indicating node synchronization time with simulation time\n    arguments=['-configuration_directory', cartographer_config_dir,\n               '-configuration_basename', configuration_basename]\n    # configuration_directory specifies where the configuration files are\n    # configuration_basename specifies the configuration file name\n    ),\nNode(\n    package='cartographer_ros',\n    executable='cartographer_occupancy_grid_node',\n    output='screen',\n    name='occupancy_grid_node',\n    parameters=[{'use_sim_time': True}],\n    arguments=['-resolution', '0.05', '-publish_period_sec', '1.0']\n    # resolution specifies number of meters per grid in the map\n    # publish_period_sec specifies frequency of publishing to /map topic\n    )\n"})}),"\n",(0,t.jsxs)(n.p,{children:["We then create a LUA file named ",(0,t.jsx)(n.code,{children:"cartographer.lua"})," within the config directory."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:'include "map_builder.lua"\ninclude "trajectory_builder.lua"\n\noptions = {\n  map_builder = MAP_BUILDER,\n  trajectory_builder = TRAJECTORY_BUILDER,\n  map_frame = "map",\n  tracking_frame = "base_footprint",\n  published_frame = "odom",\n  odom_frame = "odom",\n  provide_odom_frame = false,\n  publish_frame_projected_to_2d = true,\n  use_odometry = true,\n  use_nav_sat = false,\n  use_landmarks = false,\n  num_laser_scans = 1,\n  num_multi_echo_laser_scans = 0,\n  num_subdivisions_per_laser_scan = 1,\n  num_point_clouds = 0,\n  lookup_transform_timeout_sec = 0.2,\n  submap_publish_period_sec = 0.3,\n  pose_publish_period_sec = 5e-3,\n  trajectory_publish_period_sec = 30e-3,\n  rangefinder_sampling_ratio = 1.,\n  odometry_sampling_ratio = 1.,\n  fixed_frame_pose_sampling_ratio = 1.,\n  imu_sampling_ratio = 1.,\n  landmarks_sampling_ratio = 1.,\n}\n\nMAP_BUILDER.use_trajectory_builder_2d = true\n\nTRAJECTORY_BUILDER_2D.min_range = 0.12\nTRAJECTORY_BUILDER_2D.max_range = 3.5\nTRAJECTORY_BUILDER_2D.missing_data_ray_length = 3.0\nTRAJECTORY_BUILDER_2D.use_imu_data = false\nTRAJECTORY_BUILDER_2D.use_online_correlative_scan_matching = true\nTRAJECTORY_BUILDER_2D.motion_filter.max_angle_radians = math.rad(0.1)\n\nPOSE_GRAPH.constraint_builder.min_score = 0.65\nPOSE_GRAPH.constraint_builder.global_localization_min_score = 0.7\n\n-- POSE_GRAPH.optimize_every_n_nodes = 0\n\nreturn options\n'})}),"\n",(0,t.jsx)(n.p,{children:"Make sure that within setup.py, we specify the new config and lua directories. If you're using C++, make sure to specify the DIRECTORIES within CMakeList."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-py",children:"(os.path.join('share', package_name, 'launch'), glob('launch/*.launch.py')),\n(os.path.join('share', package_name, 'config'), glob('config/*')),\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"install(DIRECTORY\n    launch\n    config\n    DESTINATION share/${PROJECT_NAME}/\n)\n"})}),"\n",(0,t.jsx)(n.p,{children:"We can then compile the package and launch the launch file. We can then run rviz2 on another terminal while this is running."}),"\n",(0,t.jsxs)(n.p,{children:["To display our mapping, add the ",(0,t.jsx)(n.code,{children:"map"})," display and set the topic to ",(0,t.jsx)(n.code,{children:"/map"}),". If the mapping isn't showing, then the Quality of Service (QoS) parameters of the ",(0,t.jsx)(n.code,{children:"/map"})," may be wrong. We can add a couple more displays."]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"TF"}),": Allows us to see the frames of the robot"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"LaserScan"}),": Allows us to see the laser coliding with the objects on the map"]}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsx)(n.p,{children:"These are all specific to the hardware configurations the construct provides"})}),"\n",(0,t.jsx)("img",{src:o().src,width:"100%"}),"\n",(0,t.jsx)(n.p,{children:"After moving and mapping around, we'll have our entire domain."}),"\n",(0,t.jsx)("img",{src:c().src,width:"100%"}),"\n",(0,t.jsx)(n.h3,{id:"different-configurations",children:"Different Configurations"}),"\n",(0,t.jsxs)(n.p,{children:["Cartographer works for many robots and sensors but must be configured properly to work optimally. By default, cartographer automatically subscribes to ",(0,t.jsx)(n.code,{children:"/scan, /odom, /imu"})," topics. All configurations can be given from the Lua configuration file.This means that in the launch files, we have to remap those three if we want to publish data to them."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-py",children:"from launch import LaunchDescription\nfrom launch_ros.actions import Node\n\ndef generate_launch_description():\n    return LaunchDescription([\n        Node(\n            package='cartographer_ros',\n            executable='cartographer_node',\n            name='cartographer',\n            remappings=[\n                ('/scan', '/my_laser_scan'),\n                ('/odom', '/my_odom'),\n                ('/imu', '/my_imu')\n            ]\n        )\n    ])\n"})}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:(0,t.jsx)(n.strong,{children:"Category"})}),(0,t.jsx)(n.th,{children:(0,t.jsx)(n.strong,{children:"Parameter"})}),(0,t.jsx)(n.th,{children:(0,t.jsx)(n.strong,{children:"Description"})}),(0,t.jsx)(n.th,{children:(0,t.jsx)(n.strong,{children:"Default"})})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Frames"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"map_frame"})}),(0,t.jsx)(n.td,{children:"ROS frame ID for publishing sub-maps, the parent frame of poses."}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"map"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"tracking_frame"})}),(0,t.jsxs)(n.td,{children:["Frame ID tracked by SLAM. IMU position if used, commonly ",(0,t.jsx)(n.code,{children:"base_link"})," or ",(0,t.jsx)(n.code,{children:"base_footprint"}),"."]}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"base_link"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"published_frame"})}),(0,t.jsxs)(n.td,{children:["Child frame for publishing poses. If ",(0,t.jsx)(n.code,{children:"odom"})," provided, it publishes pose of ",(0,t.jsx)(n.code,{children:"odom"})," in ",(0,t.jsx)(n.code,{children:"map_frame"}),"."]}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.code,{children:"odom"})," or ",(0,t.jsx)(n.code,{children:"base_link"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"odom_frame"})}),(0,t.jsxs)(n.td,{children:["Frame for publishing local SLAM result if ",(0,t.jsx)(n.code,{children:"provide_odom_frame"})," is true."]}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"odom"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"provide_odom_frame"})}),(0,t.jsxs)(n.td,{children:["Publishes local non-loop-closed pose as ",(0,t.jsx)(n.code,{children:"odom_frame"})," in ",(0,t.jsx)(n.code,{children:"map_frame"})," if enabled."]}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"true"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"use_odometry"})}),(0,t.jsxs)(n.td,{children:["Subscribes to ",(0,t.jsx)(n.code,{children:"nav_msgs/Odometry"})," on ",(0,t.jsx)(n.code,{children:"odom"})," topic and includes odometry in SLAM."]}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"true"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"use_nav_sat"})}),(0,t.jsxs)(n.td,{children:["Subscribes to ",(0,t.jsx)(n.code,{children:"sensor_msgs/NavSatFix"})," on ",(0,t.jsx)(n.code,{children:"fix"})," topic and includes navigation data in SLAM."]}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"true"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Laser Parameters"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"num_laser_scans"})}),(0,t.jsx)(n.td,{children:"Number of laser scan topics to subscribe to."}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"1"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"num_multi_echo_laser_scans"})}),(0,t.jsx)(n.td,{children:"Number of multi-echo laser scan topics to subscribe to."}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"0"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"num_subdivisions_per_laser_scan"})}),(0,t.jsx)(n.td,{children:"Number of point clouds to split each laser scan for unwarping during motion."}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"1"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"num_point_clouds"})}),(0,t.jsx)(n.td,{children:"Number of point cloud topics to subscribe to."}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"1"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Filter Parameters"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"lookup_transform_timeout_sec"})}),(0,t.jsx)(n.td,{children:"Timeout in seconds for looking up transforms using tf2."}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"0.2"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"submap_publish_period_sec"})}),(0,t.jsx)(n.td,{children:"Interval in seconds to publish submap poses."}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"0.3"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"pose_publish_period_sec"})}),(0,t.jsx)(n.td,{children:"Interval in seconds to publish poses (e.g., 5e-3 for 200 Hz)."}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"5e-3"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"trajectory_publish_period_sec"})}),(0,t.jsx)(n.td,{children:"Interval in seconds to publish trajectory markers (e.g., 30e-3 for 30 ms)."}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"30e-3"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"odometry_sampling_ratio"})}),(0,t.jsx)(n.td,{children:"Sampling ratio for odometry messages."}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"1.0"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"fixed_frame_sampling_ratio"})}),(0,t.jsx)(n.td,{children:"Sampling ratio for fixed frame messages."}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"1.0"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"imu_sampling_ratio"})}),(0,t.jsx)(n.td,{children:"Sampling ratio for IMU messages."}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"1.0"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"landmarks_sampling_ratio"})}),(0,t.jsx)(n.td,{children:"Sampling ratio for landmark messages."}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"1.0"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.strong,{children:"Trajectory Builder"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"TRAJECTORY_BUILDER_2D.min_range"})}),(0,t.jsx)(n.td,{children:"Minimum distance measured to be considered for mapping."}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"0.2"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"TRAJECTORY_BUILDER_2D.max_range"})}),(0,t.jsx)(n.td,{children:"Maximum distance measured to be considered for mapping."}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"30.0"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"TRAJECTORY_BUILDER_2D.missing_data_ray_length"})}),(0,t.jsx)(n.td,{children:"Distance to treat as a lost laser ray."}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"25.0"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"TRAJECTORY_BUILDER_2D.use_imu_data"})}),(0,t.jsx)(n.td,{children:"Whether or not to use IMU data."}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"true"})})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:["If we want to save the map that we mapped out, we can run an executable named ",(0,t.jsx)(n.code,{children:"map_saver"})," from ",(0,t.jsx)(n.code,{children:"nav2_map_server"}),". It's important that we call this within the directory that we want to save the map in. The cartography has to be running for this to work."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"ros2 run nav2_map_server map_saver_cli -f <name>\n"})}),"\n",(0,t.jsxs)(n.p,{children:["This'll generate two files of type ",(0,t.jsx)(n.code,{children:".pgm and .yaml"}),". The ",(0,t.jsx)(n.code,{children:".pgm"})," is an image file of the map as an occupancy grid image. The ",(0,t.jsx)(n.code,{children:".yaml"})," contains details about the resolution of the map."]}),"\n",(0,t.jsx)(n.p,{children:"Example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"image: turtlebot_area.pgm\nmode: trinary\nresolution: 0.05 # Resolution of the map (meters/pixel)\norigin: [-3.8, -1.84, 0] # Coordinates of the lower-left pixel on the map (x,y,z). The third value indicates rotation and if there is none, value is 0\nnegate: 0 # Inverts the color of the map.\noccupied_thresh: 0.65 # Pixels with a value greater than this value will be considered an occupied zone\nfree_thresh: 0.25 # Pixels with a value smaller than this will be considered a completely free zone\n"})}),"\n",(0,t.jsx)(n.h3,{id:"using-saved-map",children:"Using Saved Map"}),"\n",(0,t.jsxs)(n.p,{children:["If we want to use this saved map, we have to launch ",(0,t.jsx)(n.code,{children:"map_server"})," and ",(0,t.jsx)(n.code,{children:"nav2_lifecycle_manager"}),". We can create a custom launch file for this, but we must specify some parameters."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-py",children:"from launch import LaunchDescription\nfrom launch_ros.actions import Node\nfrmo ament_index_python.packages import get_package_share_directory\nimport os\n\ndef generate_launch_description():\n    map_file = os.path.join(get_package_share_directory('map_server'), 'config', 'turtlebot_area.yaml')\n    return LaunchDescription([\n        Node(\n            package=\"nav2_map_server\",\n            executable=\"map_server\",\n            name=\"map_server\",\n            output=\"screen\",\n            parameters=[{'use_sim_time': True}, # Boolean indicating if map_server must synchronize with its time with the simulation\n                        {'yaml_filename':map_file] # The complete path to the map yaml file\n            ),\n        Node(\n            package=\"nav2_lifecycle_manager\",\n            executable=\"lifecycle_manager\",\n            name=\"lifecycle_manager_mapper\",\n            output=\"screen\",\n            parameters=[{'use_sim_time': True},\n                        {'autostart': True}, # lifecycle manager autostart when launched\n                        {'node_names':  ['map_server']}] # Nodes that the lifecycle manager takes care of\n            )\n        ])\n"})}),"\n",(0,t.jsx)(n.p,{children:"We can try using our saved map by creating a ROS2 package called map_server, placing our saved map files inside of config, and creating our launch file. Note that we can just put our launch file in any package and just create a new launch file with our configs."}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsx)(n.p,{children:"You must specify your map display durability as Transient Local. Volatile means use incoming data being published as the map source, while transient local allows us to check if we had any cached messages that were published but not received by our subscriber as well as all incoming data."})}),"\n",(0,t.jsx)(n.h2,{id:"nav2-lifecycle-manager",children:"Nav2 Lifecycle Manager"}),"\n",(0,t.jsx)(n.p,{children:"Navigation nodes are managed nodes meaning that they can be easily controlled to be restarted, paused, or running. They can do so by being at these states:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Unconfigured"}),"\n",(0,t.jsx)(n.li,{children:"Inactive"}),"\n",(0,t.jsx)(n.li,{children:"Active"}),"\n",(0,t.jsx)(n.li,{children:"Finalized"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["The diagram is taken from the course and depicts how nodes transition from one state to another. Seems to be like a state machine.\n",(0,t.jsx)(n.img,{src:"https://s3.eu-west-1.amazonaws.com/notebooks.ws/ros2-navigation-humble-148/images/lifecycle.png",alt:"Node Transition"})]}),"\n",(0,t.jsxs)(n.p,{children:["Managed nodes start at the ",(0,t.jsx)(n.code,{children:"unconfigured"})," state and is active usually when running. To transition to ",(0,t.jsx)(n.code,{children:"active"}),", nodes need an external agent that moves them to this state. Several nodes in Nav2, such as ",(0,t.jsx)(n.code,{children:"map_server"}),", ",(0,t.jsx)(n.code,{children:"amcl"}),", ",(0,t.jsx)(n.code,{children:"planner_server"}),", and ",(0,t.jsx)(n.code,{children:"controller_server"}),", are lifecycle enabled meaning they are managed nodes."]}),"\n",(0,t.jsx)(n.p,{children:"These nodes have the required overrides of the lifecycle functions:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"on_configure()"}),"\n",(0,t.jsx)(n.li,{children:"on_activate()"}),"\n",(0,t.jsx)(n.li,{children:"on_deactivate()"}),"\n",(0,t.jsx)(n.li,{children:"on_cleanup()"}),"\n",(0,t.jsx)(n.li,{children:"on_shutdown()"}),"\n",(0,t.jsx)(n.li,{children:"on_error()"}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"lifecycle-manager",children:"Lifecycle Manager"}),"\n",(0,t.jsxs)(n.p,{children:["In Nav2, the external agent that helps transition nodes to an active state is called the ",(0,t.jsx)(n.code,{children:"nav2_lifecycle_manager"}),". The lifecycle manager changes the state of the managed nodes to achieve a controlled startup, shutdown, reset, pause, or resume of the navigation stack."]}),"\n",(0,t.jsx)(n.p,{children:"Referenced from Steve Macenski"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:"https://s3.eu-west-1.amazonaws.com/notebooks.ws/ros2-navigation-humble-148/images/diagram_lifecycle_manager.png",alt:"Figure"})}),"\n",(0,t.jsxs)(n.p,{children:["Nav2 uses a wrapper of ",(0,t.jsx)(n.code,{children:"LifecycleNode"}),", the ",(0,t.jsx)(n.code,{children:"nav2_util LifecycleNode"})," and it hides many abstractions of LifecycleNodes for typical applications. It includes a bond connection for the ",(0,t.jsx)(n.code,{children:"lifecycle manager"})," to ensure that after a node transitions up, it also remains active. When a node crashes, it lets the ",(0,t.jsx)(n.code,{children:"lifecycle manager"})," know and transitions down the system to prevent a critical failure."]}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"nav2_lifecycle_manager"})," provides a ROS service from which other ROS nodes can invoke the startup, shutdown, reset, pause, or resume functions. Based on these requests, the ",(0,t.jsx)(n.code,{children:"nav2_lifecycle_manager"})," calls the necessary lifecycle services in the managed nodes. As shown previously in the ",(0,t.jsx)(n.code,{children:"nav2_lifecycle_manager"})," node within the launch file, we specify which nodes need management via ",(0,t.jsx)(n.code,{children:"node_names"}),". The ordering matters as that is the order in which they have to be moved to initialized (first to last) and the order in which they are paused and stopped (last to first)."]}),"\n",(0,t.jsxs)(n.p,{children:["It's important that the manager has the ",(0,t.jsx)(n.code,{children:"autostart"})," parameter which allows the ",(0,t.jsx)(n.code,{children:"nav2_lifecycle_manager"})," to do it's default behavior."]}),"\n",(0,t.jsxs)(n.p,{children:["You interact with the ",(0,t.jsx)(n.code,{children:"nav2_lifecycle_manager"})," via a service named:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'/<lifecycle_manager_node_name>/manage_nodes\n\nros2 service call /lifecycle_manager/manage_nodes nav2_msgs/srv/ManageLifecycleNodes "{command: 0}" # Start the nodes\nros2 service call /lifecycle_manager/manage_nodes nav2_msgs/srv/ManageLifecycleNodes "{command: 1}" # Pause the nodes\nros2 service call /lifecycle_manager/manage_nodes nav2_msgs/srv/ManageLifecycleNodes "{command: 2}" # Resume the nodes\nros2 service call /lifecycle_manager/manage_nodes nav2_msgs/srv/ManageLifecycleNodes "{command: 3}" # Reset the nodes\nros2 service call /lifecycle_manager/manage_nodes nav2_msgs/srv/ManageLifecycleNodes "{command: 4}" # Shutdown the nodes\n'})}),"\n",(0,t.jsxs)(n.p,{children:["This is because the service ",(0,t.jsx)(n.code,{children:"/manage_nodes"})," uses the message ",(0,t.jsx)(n.code,{children:"nav2_msgs/srv/ManageLifecycleNodes"})," which is as follows:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-txt",children:"uint8 STARTUP = 0\nuint8 PAUSE = 1\nuint8 RESUME = 2\nuint8 RESET = 3\nuint8 SHUTDOWN = 4\n\nuint8 command\n---\nbool success\n"})}),"\n",(0,t.jsx)(n.h2,{id:"localization",children:"Localization"}),"\n",(0,t.jsx)(n.p,{children:"Localization is knowing the current position with respect to the environment. This means knowing the position and orientation. This is otherwise known as the pose."}),"\n",(0,t.jsxs)(n.p,{children:["ROS has a very robust algorithm for localization. It uses ",(0,t.jsx)(n.code,{children:"AMCL"})," which is the Adaptive Monte-Carlo Licalization and uses a probabilistic localization system for a robot moving in 2D. It implements the adaptive or KLD sampling Monte Carlo localization approach which uses a particle filter to track a robot's pose against a known map."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsxs)(n.strong,{children:["A ROS Robot is localized when somebody publishes a transform between the ",(0,t.jsx)(n.code,{children:"/map"})," frame and the ",(0,t.jsx)(n.code,{children:"/odom"})," frame"]})}),"\n",(0,t.jsxs)(n.p,{children:["That means that the ",(0,t.jsx)(n.code,{children:"/odom"})," frame of the robot knows its relative position to the ",(0,t.jsx)(n.code,{children:"/map"})," frame. Therefore, the robot knows its position on the map since ",(0,t.jsx)(n.code,{children:"/base_link"})," frame is directly connected to the ",(0,t.jsx)(n.code,{children:"/odom"})," frame."]}),"\n",(0,t.jsx)(n.p,{children:"When everything is correct, the AMCL publishes that transform."}),"\n",(0,t.jsx)(n.h3,{id:"ros2-localization",children:"ROS2 Localization"}),"\n",(0,t.jsx)(n.p,{children:"In order to localize, we need three nodes:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"map_server"}),": provides the map to the localization algorithm"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"localization"}),": the algorithm"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"life cycle manager"}),": state manager"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Let's create an ",(0,t.jsx)(n.code,{children:"ament_cmake"})," package and the launch file for all three nodes."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-py",children:"from ament_index_python.packages import get_package_share_directory\nfrom launch import LaunchDescription\nfrom launch_ros.actions import Node\nimport os\n\ndef generate_launch_description():\n    nav2_yaml = os.path.join(get_package_share_directory('localization'), 'config', 'amcl_config.yaml')\n    map_file = os.path.join(get_package_share_directory('map_server'), 'config', 'turtlebot_area.yaml')\n    print(map_file)\n    return LaunchDescription([\n        Node(\n            package=\"nav2_map_server\",\n            executable=\"map_server\",\n            name=\"map_server\",\n            output=\"screen\",\n            parameters=[{'use_sim_time': True}, {'yaml_filename': map_file}] ## This is the saved map we got from our cartography.\n            ),\n        Node(\n            package=\"nav2_amcl\",\n            executable=\"amcl\",\n            name=\"amcl\",\n            output=\"screen\",\n            parameters=[nav2_yaml]\n            ),\n        Node(\n            package=\"nav2_lifecycle_manager\",\nLaunch Fil            executable=\"lifecycle_manager\",\n            name=\"lifecycle_manager\",\n            output=\"screen\",\n            parameters=[{'use_sim_time': True},\n                        {'autostart': True},\n                        {'node_names': ['map_server', 'amcl']}]\n            )\n        ])\n"})}),"\n",(0,t.jsx)(n.p,{children:"The amcl_config specifies the configurations for the localization algorithm. This goes inside of the config directory of your package."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'amcl:\n  ros__parameters:\n    use_sim_time: True\n    alpha1: 0.2\n    alpha2: 0.2\n    alpha3: 0.2\n    alpha4: 0.2\n    alpha5: 0.2\n    base_frame_id: "base_footprint"\n    beam_skip_distance: 0.5\n    beam_skip_error_threshold: 0.9\n    beam_skip_threshold: 0.3\n    do_beamskip: false\n    global_frame_id: "map"\n    lambda_short: 0.1\n    laser_likelihood_max_dist: 2.0\n    laser_max_range: 100.0\n    laser_min_range: -1.0\n    laser_model_type: "likelihood_field"\n    max_beams: 60\n    max_particles: 8000\n    min_particles: 200\n    odom_frame_id: "odom"\n    pf_err: 0.05\n    pf_z: 0.99\n    recovery_alpha_fast: 0.0\n    recovery_alpha_slow: 0.0\n    resample_interval: 1\n    robot_model_type: "nav2_amcl::DifferentialMotionModel"\n    save_pose_rate: 0.5\n    sigma_hit: 0.2\n    tf_broadcast: true\n    transform_tolerance: 1.0\n    update_min_a: 0.2\n    update_min_d: 0.25\n    z_hit: 0.5\n    z_max: 0.05\n    z_rand: 0.5\n    z_short: 0.05\n'})}),"\n",(0,t.jsx)(n.p,{children:"Make sure to add launch and config files respective to whatever build package you are using."}),"\n",(0,t.jsx)(n.h4,{id:"for-python",children:"For Python"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-py",children:"(os.path.join('share', package_name, 'launch'), glob('launch/*.launch.py')),\n(os.path.join('share', package_name, 'config'), glob('config/*')),\n"})}),"\n",(0,t.jsx)(n.h4,{id:"for-c",children:"For C++"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-text",children:"install(DIRECTORY\n        launch\n        config\n        DESTINATION $share/{PROJECT_NAME}\n)\n"})}),"\n",(0,t.jsx)(n.p,{children:"If all is placed correctly, we should be able to receive our old map. From there onwards, you want to configure your RVIZ settings with these below:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"map"}),": Environment"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"TF"}),": Frames of the robot"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Robot Model"}),": Robot structure (uses URDF model)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Laser Scan"}),": Estimate of robot position relative to actual map"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Pose with Covariance"}),": Status of the localization"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Particle Cloud"}),": See the localization particle distribution"]}),"\n"]}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsx)(n.p,{children:"Particle cloud uses the reliability policy of best effort and not volatile. If you want to use these configs again, you can save them."})}),"\n",(0,t.jsxs)(n.p,{children:["We can use the ",(0,t.jsx)(n.code,{children:"2D Pose Estimate"})," to tell our ",(0,t.jsx)(n.code,{children:"AMCL"})," system to start localizing the robot. You want to put it at a rough estimate of where the robot is so the algorithm can estimate roughly from the initial state. This'll start publishing the transform between ",(0,t.jsx)(n.code,{children:"map"})," and ",(0,t.jsx)(n.code,{children:"odom"})," topics respectively. When we say transform, it means relationship. The map and odom data are independent from oen another, but there is a mathematical relationship between them using AMCL, and can be used to \"localize\" our robot's position from these data. That's because we have laser scan (environment scanning) and odometry (wheel/position)."]}),"\n",(0,t.jsx)(n.p,{children:"If we start moving our robot, our estimation and localization starts to fit better."}),"\n",(0,t.jsx)("iframe",{width:"100%",height:"650px",src:d,allow:"accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:!0,title:"Localization Video",children:" "}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsxs)(n.p,{children:["For 2D Localization, we only need ",(0,t.jsxs)(n.span,{className:"katex",children:[(0,t.jsx)(n.span,{className:"katex-mathml",children:(0,t.jsx)(n.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(n.semantics,{children:[(0,t.jsxs)(n.mrow,{children:[(0,t.jsx)(n.mo,{stretchy:"false",children:"("}),(0,t.jsx)(n.mi,{children:"x"}),(0,t.jsx)(n.mo,{separator:"true",children:","}),(0,t.jsx)(n.mi,{children:"y"}),(0,t.jsx)(n.mo,{separator:"true",children:","}),(0,t.jsx)(n.mi,{children:"\u03b8"}),(0,t.jsx)(n.mo,{stretchy:"false",children:")"})]}),(0,t.jsx)(n.annotation,{encoding:"application/x-tex",children:"(x,y, \\theta)"})]})})}),(0,t.jsx)(n.span,{className:"katex-html","aria-hidden":"true",children:(0,t.jsxs)(n.span,{className:"base",children:[(0,t.jsx)(n.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,t.jsx)(n.span,{className:"mopen",children:"("}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"x"}),(0,t.jsx)(n.span,{className:"mpunct",children:","}),(0,t.jsx)(n.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,t.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"y"}),(0,t.jsx)(n.span,{className:"mpunct",children:","}),(0,t.jsx)(n.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,t.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"\u03b8"}),(0,t.jsx)(n.span,{className:"mclose",children:")"})]})})]})," and are the variables used for setting the robot in the ",(0,t.jsx)(n.code,{children:"map"})," frame. We can compute ",(0,t.jsxs)(n.span,{className:"katex",children:[(0,t.jsx)(n.span,{className:"katex-mathml",children:(0,t.jsx)(n.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(n.semantics,{children:[(0,t.jsxs)(n.mrow,{children:[(0,t.jsx)(n.mo,{stretchy:"false",children:"("}),(0,t.jsx)(n.mi,{children:"x"}),(0,t.jsx)(n.mo,{separator:"true",children:","}),(0,t.jsx)(n.mi,{children:"y"}),(0,t.jsx)(n.mo,{separator:"true",children:","}),(0,t.jsx)(n.mi,{children:"\u03b8"}),(0,t.jsx)(n.mo,{stretchy:"false",children:")"})]}),(0,t.jsx)(n.annotation,{encoding:"application/x-tex",children:"(x,y,\\theta)"})]})})}),(0,t.jsx)(n.span,{className:"katex-html","aria-hidden":"true",children:(0,t.jsxs)(n.span,{className:"base",children:[(0,t.jsx)(n.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,t.jsx)(n.span,{className:"mopen",children:"("}),(0,t.jsx)(n.span,{className:"mord mathnormal",children:"x"}),(0,t.jsx)(n.span,{className:"mpunct",children:","}),(0,t.jsx)(n.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,t.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"y"}),(0,t.jsx)(n.span,{className:"mpunct",children:","}),(0,t.jsx)(n.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,t.jsx)(n.span,{className:"mord mathnormal",style:{marginRight:"0.02778em"},children:"\u03b8"}),(0,t.jsx)(n.span,{className:"mclose",children:")"})]})})]})," by using the AMCL.\nThe Adaptive Monte Carlo Localization algorithm uses particles to localize the robot. Each particle have their own coordinates, orientation value, and a weight. These weights are the likelihood of the particle being a good estimate of the robot's actual pose based on our sensor data. That means that if our weight is higher for a given particle, that particle is more likely to represent the robot's true pose. These particles are then re-sampled whenever the robot moves and with new sensor data, the higher likelihood particles remain and will converge over many iterations to the robot's true pose."]})}),"\n",(0,t.jsx)(n.p,{children:"To get a good localization of our robot, we need to configure out AMCL node from our amcl_config.yaml. Below are the parameters and their respective categories."}),"\n",(0,t.jsx)(n.h4,{id:"overall-filter-parameters",children:"Overall Filter Parameters"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Parameter"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Default"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"min_particles"})}),(0,t.jsx)(n.td,{children:"int"}),(0,t.jsx)(n.td,{children:"500"}),(0,t.jsx)(n.td,{children:"Minimum allowed number of particles."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"max_particles"})}),(0,t.jsx)(n.td,{children:"int"}),(0,t.jsx)(n.td,{children:"2000"}),(0,t.jsx)(n.td,{children:"Maximum allowed number of particles."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"update_min_d"})}),(0,t.jsx)(n.td,{children:"double"}),(0,t.jsx)(n.td,{children:"0.25 meters"}),(0,t.jsx)(n.td,{children:"Translational movement required before performing a filter update."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"update_min_a"})}),(0,t.jsx)(n.td,{children:"double"}),(0,t.jsx)(n.td,{children:"0.2 radians"}),(0,t.jsx)(n.td,{children:"Rotational movement required before performing a filter update."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"resample_interval"})}),(0,t.jsx)(n.td,{children:"int"}),(0,t.jsx)(n.td,{children:"1"}),(0,t.jsx)(n.td,{children:"Number of filter updates required before re-sampling."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"transform_tolerance"})}),(0,t.jsx)(n.td,{children:"double"}),(0,t.jsx)(n.td,{children:"1.0 seconds"}),(0,t.jsx)(n.td,{children:"Time to post-date the published transform, indicating validity into the future."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"recovery_alpha_slow"})}),(0,t.jsx)(n.td,{children:"double"}),(0,t.jsx)(n.td,{children:"0.0 (disabled)"}),(0,t.jsx)(n.td,{children:"Exponential decay rate for the slow average weight filter; helps decide recovery with random poses. Suggested: 0.001."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"recovery_alpha_fast"})}),(0,t.jsx)(n.td,{children:"double"}),(0,t.jsx)(n.td,{children:"0.0 (disabled)"}),(0,t.jsx)(n.td,{children:"Exponential decay rate for the fast average weight filter; helps decide recovery with random poses. Suggested: 0.1."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"set_initial_pose"})}),(0,t.jsx)(n.td,{children:"bool"}),(0,t.jsx)(n.td,{children:"false"}),(0,t.jsxs)(n.td,{children:["Causes AMCL to set the initial pose from ",(0,t.jsx)(n.code,{children:"initial_pose*"})," parameters instead of waiting for the ",(0,t.jsx)(n.code,{children:"initial_pose"})," message."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"initial_pose"})}),(0,t.jsx)(n.td,{children:"Pose2D"}),(0,t.jsx)(n.td,{children:0}),(0,t.jsx)(n.td,{children:"X, Y, Z, and yaw coordinates of the robot base frame's initial pose in the global frame."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"always_reset_initial_pose"})}),(0,t.jsx)(n.td,{children:"bool"}),(0,t.jsx)(n.td,{children:"false"}),(0,t.jsx)(n.td,{children:"Requires an initial pose on reset. Uses the last known pose if false."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"save_pose_rate"})}),(0,t.jsx)(n.td,{children:"double"}),(0,t.jsx)(n.td,{children:"0.5 Hz"}),(0,t.jsx)(n.td,{children:"Maximum rate at which to save the last estimated pose and covariance to the parameter server. Use -1.0 to disable."})]})]})]}),"\n",(0,t.jsx)(n.h4,{id:"laser-model-parameters",children:"Laser Model Parameters"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Parameter"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Default"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"laser_min_range"})}),(0,t.jsx)(n.td,{children:"double"}),(0,t.jsx)(n.td,{children:"-1.0"}),(0,t.jsx)(n.td,{children:"Minimum scan range to be considered. Use laser's minimum range if set to -1.0."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"laser_max_range"})}),(0,t.jsx)(n.td,{children:"double"}),(0,t.jsx)(n.td,{children:"100"}),(0,t.jsx)(n.td,{children:"Maximum scan range to be considered. Use laser's maximum range if set to -1.0."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"max_beams"})}),(0,t.jsx)(n.td,{children:"int"}),(0,t.jsx)(n.td,{children:"60"}),(0,t.jsx)(n.td,{children:"Number of evenly-spaced beams in each scan used when updating the filter."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"z_hit"})}),(0,t.jsx)(n.td,{children:"double"}),(0,t.jsx)(n.td,{children:"0.5"}),(0,t.jsxs)(n.td,{children:["Mixture weight for ",(0,t.jsx)(n.code,{children:"z_hit"})," part of the model."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"z_short"})}),(0,t.jsx)(n.td,{children:"double"}),(0,t.jsx)(n.td,{children:"0.05"}),(0,t.jsxs)(n.td,{children:["Mixture weight for the ",(0,t.jsx)(n.code,{children:"z_short"})," part of the model."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"z_max"})}),(0,t.jsx)(n.td,{children:"double"}),(0,t.jsx)(n.td,{children:"0.05"}),(0,t.jsxs)(n.td,{children:["Mixture weight for the ",(0,t.jsx)(n.code,{children:"z_max"})," part of the model."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"z_rand"})}),(0,t.jsx)(n.td,{children:"double"}),(0,t.jsx)(n.td,{children:"0.5"}),(0,t.jsxs)(n.td,{children:["Mixture weight for the ",(0,t.jsx)(n.code,{children:"z_rand"})," part of the model."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"sigma_hit"})}),(0,t.jsx)(n.td,{children:"double"}),(0,t.jsx)(n.td,{children:"0.2 meters"}),(0,t.jsxs)(n.td,{children:["Standard deviation for Gaussian model used in ",(0,t.jsx)(n.code,{children:"z_hit"})," part."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"lambda_short"})}),(0,t.jsx)(n.td,{children:"double"}),(0,t.jsx)(n.td,{children:"0.1"}),(0,t.jsxs)(n.td,{children:["Exponential decay parameter for the ",(0,t.jsx)(n.code,{children:"z_short"})," part of the model."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"laser_likelihood_max_dist"})}),(0,t.jsx)(n.td,{children:"double"}),(0,t.jsx)(n.td,{children:"2.0 meters"}),(0,t.jsx)(n.td,{children:"Maximum distance for obstacle inflation in the likelihood_field model."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"laser_model_type"})}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:'"likelihood_field"'}),(0,t.jsxs)(n.td,{children:["Model to use: ",(0,t.jsx)(n.code,{children:"beam"}),", ",(0,t.jsx)(n.code,{children:"likelihood_field"}),", or ",(0,t.jsx)(n.code,{children:"likelihood_field_prob"})," (includes beam skipping)."]})]})]})]}),"\n",(0,t.jsx)(n.p,{children:"Mixture weights should sum to 1."}),"\n",(0,t.jsx)(n.h4,{id:"odometry-model-parameters",children:"Odometry Model Parameters"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Parameter"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Default"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"robot_model_type"})}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:'"differential"'}),(0,t.jsxs)(n.td,{children:["Type of motion model: ",(0,t.jsx)(n.code,{children:"differential"})," or ",(0,t.jsx)(n.code,{children:"omnidirectional"}),"."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"alpha1"})}),(0,t.jsx)(n.td,{children:"double"}),(0,t.jsx)(n.td,{children:"0.2"}),(0,t.jsx)(n.td,{children:"Noise in odometry's rotation estimate from rotational motion."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"alpha2"})}),(0,t.jsx)(n.td,{children:"double"}),(0,t.jsx)(n.td,{children:"0.2"}),(0,t.jsx)(n.td,{children:"Noise in odometry's rotation estimate from translational motion."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"alpha3"})}),(0,t.jsx)(n.td,{children:"double"}),(0,t.jsx)(n.td,{children:"0.2"}),(0,t.jsx)(n.td,{children:"Noise in odometry's translation estimate from translational motion."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"alpha4"})}),(0,t.jsx)(n.td,{children:"double"}),(0,t.jsx)(n.td,{children:"0.2"}),(0,t.jsx)(n.td,{children:"Noise in odometry's translation estimate from rotational motion."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"alpha5"})}),(0,t.jsx)(n.td,{children:"double"}),(0,t.jsx)(n.td,{children:"0.2"}),(0,t.jsxs)(n.td,{children:["Translation-related noise parameter (only for ",(0,t.jsx)(n.code,{children:"omni"})," model)."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"odom_frame_id"})}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:'"odom"'}),(0,t.jsx)(n.td,{children:"Frame to use for odometry."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"base_frame_id"})}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:'"base_footprint"'}),(0,t.jsx)(n.td,{children:"Frame to use for the robot base."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"global_frame_id"})}),(0,t.jsx)(n.td,{children:"string"}),(0,t.jsx)(n.td,{children:'"map"'}),(0,t.jsx)(n.td,{children:"Name of the coordinate frame published by the localization system."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"tf_broadcast"})}),(0,t.jsx)(n.td,{children:"bool"}),(0,t.jsx)(n.td,{children:"true"}),(0,t.jsx)(n.td,{children:"Set to false to prevent AMCL from publishing the transform between global and odometry frames."})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"auto-localization",children:"Auto Localization"}),"\n",(0,t.jsx)(n.h4,{id:"via-yaml",children:"Via YAML"}),"\n",(0,t.jsxs)(n.p,{children:["If you don't want to localize via GUI ",(0,t.jsx)(n.code,{children:"rviz"}),", you can do so by modifying the configuration settings for ",(0,t.jsx)(n.code,{children:"amcl"}),". When you start your localization server, you're given the initial_pose, to which you can set those within the ",(0,t.jsx)(n.code,{children:"amcl_config"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"set_initial_pose: true\ninitial_pose:\n  x: -4.44264\n  y: 2.32243\n  yaw: 0.328028\n"})}),"\n",(0,t.jsx)(n.p,{children:"Rebuild the package, and you can start the server and not have to localize the robot."}),"\n",(0,t.jsx)(n.h4,{id:"via-cli",children:"Via CLI"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"ros2 topic pub -1 /initialpose geometry_msgs/msg/PoseWithCovarianceStamped \"{header: {stamp: {sec: 0}, frame_id: 'map'}, pose: {pose: {position: {x: 0.2, y: 0.0, z: 0.0}, orientation: {w: 1.0}}}}\"\n"})}),"\n",(0,t.jsx)(n.h3,{id:"global-localization",children:"Global Localization"}),"\n",(0,t.jsx)(n.p,{children:"Global localization is when neither the person or robot knows where it is on the map. In order to localize itself, it does global localization:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Distribute all the particles of the filter across the map. (Calls the service ",(0,t.jsx)(n.code,{children:"/reinitialize_global_localization"})]}),"\n",(0,t.jsx)(n.li,{children:"Move the robot around until it detects where the it is located. If the environment is simple, can just rotate itself."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Modify the amcl_config to increase particles:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"max_particles: 80000\nmin_particles: 2000\n"})}),"\n",(0,t.jsx)(n.p,{children:"Call the service and start moving around to localize."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"ros2 service call /reinitialize_global_localization std_srvs/srv/Empty\n"})}),"\n",(0,t.jsx)(n.h2,{id:"path-planning",children:"Path Planning"}),"\n",(0,t.jsx)(n.p,{children:"Path planning is planning a route from Point A to Point B, avoiding obstacles along the way."}),"\n",(0,t.jsx)(n.p,{children:"In ROS2, to do path planning, we have to launch several nodes. Before we start any path planning, we need to have two nodes which provides the base map and localization:"}),"\n",(0,t.jsx)(n.h5,{id:"mapping-environment",children:"Mapping Environment"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"nav2_map_server"}),": provides the base map as a topic and service"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"nav2_amcl"}),": responsible for localization via Adaptive Monte Carlo Localizer"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"To do path planning, we need these nodes:"}),"\n",(0,t.jsx)(n.h5,{id:"path-planning-1",children:"Path Planning"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"planner"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"controller"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"manager_of_recovery_behaviors"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"behavior_tree_navigator"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"nav2_lifecycle_manager"})}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"planner",children:"Planner"}),"\n",(0,t.jsxs)(n.p,{children:["The planner is responsible for computing a path from Point A to Point B. It can compute a path as soon as the robot receives a ",(0,t.jsx)(n.code,{children:"2D_Goal_Pose"})," and also has access to a global environment representation and sensor data buffered into it (",(0,t.jsx)(n.code,{children:"Global Costmap"}),")."]}),"\n",(0,t.jsxs)(n.p,{children:["Currently on Galactic, there is only one Planenr algorithm available in ROS2, the ",(0,t.jsx)(n.code,{children:"Nav2Fn_Planner"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"In order to launch the planner, we need these in the launch file:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-py",children:"package='nav2_planner', these in the ```config``` directory.\n<Tabs>\nexecutable='planner_server',\nname='planner_server',\noutput='screen',\nparameters=[nav2_yaml] # contains all of the configuration parameters\n"})}),"\n",(0,t.jsx)(n.h5,{id:"nav2_yaml",children:"nav2_yaml"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'planner_server:\n  ros__parameters:\n    expected_planner_frequency: 10.0\n    use_sim_time: True\n    planner_plugins: ["GridBased"]\n    GridBased:\n      plugin: "nav2_navfn_planner/NavfnPlanner"\n      tolerance: 0.5\n      use_astar: false\n      allow_unknown: true\n'})}),"\n",(0,t.jsx)(n.h3,{id:"controller",children:"Controller"}),"\n",(0,t.jsx)(n.p,{children:"The controller is responsible for performing reactive path planning from the current position to the maximum range of the sensors. From this data, it builds a trajectory to avoid the obstacles it encounters along the way while trying to follow the path generated by the planner. The controller is the one responsible for generating the wheel's commands."}),"\n",(0,t.jsx)(n.p,{children:"There are only two planners available in ROS2:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"dwb_controller"}),": used with ",(0,t.jsx)(n.code,{children:"differential drive"})," robots"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"TEB controller"}),": used with ",(0,t.jsx)(n.code,{children:"car-like"})," robots (doesn't work properly in Galactic)"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"In order to launch the controller, we need these in the launch file:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-py",children:"package='nav2_controller',\nexecutable='controller_server',\nname='controller_server',\noutput='screen',\nparameters=[controller_yaml] # contains all of the configuration parameters\n"})}),"\n",(0,t.jsx)(n.h5,{id:"controller_yaml",children:"controller_yaml"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'controller_server:\n  ros__parameters:\n    use_sim_time: True\n    controller_frequency: 10.0\n    min_x_velocity_threshold: 0.001\n    min_y_velocity_threshold: 0.5\n    min_theta_velocity_threshold: 0.001\n    failure_tolerance: 0.3\n    progress_checker_plugin: "progress_checker"\n    goal_checker_plugins: ["general_goal_checker"]\n    controller_plugins: ["FollowPath"]\n\n    # Progress checker parameters\n    progress_checker:\n      plugin: "nav2_controller::SimpleProgressChecker"\n      required_movement_radius: 0.5\n      movement_time_allowance: 10.0\n    # Goal checker parameters\n    general_goal_checker:\n      stateful: True\n      plugin: "nav2_controller::SimpleGoalChecker"\n      xy_goal_tolerance: 0.25\n      yaw_goal_tolerance: 0.25\n    # DWB parameters\n    FollowPath:\n      plugin: "dwb_core::DWBLocalPlanner"\n      debug_trajectory_details: True\n      min_vel_x: 0.0\n      min_vel_y: 0.0\n      max_vel_x: 0.26\n      max_vel_y: 0.0\n      max_vel_theta: 1.0\n      min_speed_xy: 0.0\n      max_speed_xy: 0.26\n      min_speed_theta: 0.0\n      acc_lim_x: 2.5\n      acc_lim_y: 0.0\n    - ```dwb_controller```: Used in ```differential drive``` robots   acc_lim_theta: 3.2\n      decel_lim_x: -2.5\n      decel_lim_y: 0.0\n      decel_lim_theta: -3.2\n      vx_samples: 20\n      vy_samples: 5\n      vtheta_samples: 20\n      sim_time: 1.7\n      linear_granularity: 0.05\n      angular_granularity: 0.025\n      transform_tolerance: 0.2\n      xy_goal_tolerance: 0.25\n      trans_stopped_velocity: 0.25\n      short_circuit_trajectory_evaluation: True\n      stateful: True\n      critics: ["RotateToGoal", "Oscillation", "BaseObstacle", "GoalAlign", "PathAlign", "PathDist", "GoalDist"]\n      BaseObstacle.scale: 0.02\n      PathAlign.scale: 32.0\n      PathAlign.forward_point_distance: 0.1\n      GoalAlign.scale: 24.0\n      GoalAlign.forward_point_distance: 0.1\n      PathDist.scale: 32.0\n      GoalDist.scale: 24.0\n      RotateToGoal.scale: 32.0\n      RotateToGoal.slowing_factor: 5.0\n      RotateToGoal.lookahead_time: -1.0\n'})}),"\n",(0,t.jsx)(n.h3,{id:"navigation-controller",children:"Navigation Controller"}),"\n",(0,t.jsxs)(n.p,{children:["The navigation controller coordinates between the planner node and the controller node. This node is called the ",(0,t.jsx)(n.code,{children:"bt_navigator"}),". It basically manages these two nodes."]}),"\n",(0,t.jsx)(n.p,{children:"Navigation controller launch file:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-py",children:"package='nav2_bt_navigator',\nexecutable='bt_navigator',\nname='bt_navigator',\noutput='screen',\nparameters=[bt_navigator_yaml]\n"})}),"\n",(0,t.jsx)(n.h5,{id:"bt_navigator_yaml",children:"bt_navigator_yaml"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'bt_navigator:\n  ros__parameters:\n    use_sim_time: True\n    global_frame: map\n    robot_base_frame: base_link\n    odom_topic: /odom\n    bt_loop_duration: 10\n    default_server_timeout: 20\n    default_nav_to_pose_bt_xml: "/home/user/ros2_ws/src/path_planner_server/config/behavior.xml"\n    plugin_lib_names:\n      - nav2_compute_path_to_pose_action_bt_node\n      - nav2_compute_path_through_poses_action_bt_node\n      - nav2_smooth_path_action_bt_node\n      - nav2_follow_path_action_bt_node\n      - nav2_spin_action_bt_node\n      - nav2_wait_action_bt_node\n      - nav2_back_up_action_bt_node\n      - nav2_drive_on_heading_bt_node\n      - nav2_clear_costmap_service_bt_node\n      - nav2_is_stuck_condition_bt_node\n      - nav2_goal_reached_condition_bt_node\n      - nav2_goal_updated_condition_bt_node\n      - nav2_globally_updated_goal_condition_bt_node\n      - nav2_is_path_valid_condition_bt_node\n      - nav2_initial_pose_received_condition_bt_node\n      - nav2_reinitialize_global_localization_service_bt_node\n      - nav2_rate_controller_bt_node\n      - nav2_distance_controller_bt_node\n      - nav2_speed_controller_bt_node\n      - nav2_truncate_path_action_bt_node\n      - nav2_truncate_path_local_action_bt_node\n      - nav2_goal_updater_node_bt_node\n      - nav2_recovery_node_bt_node\n      - nav2_pipeline_sequence_bt_node\n      - nav2_round_robin_node_bt_node\n      - nav2_transform_available_condition_bt_node\n      - nav2_time_expired_condition_bt_node\n      - nav2_path_expiring_timer_condition\n      - nav2_distance_traveled_condition_bt_node\n      - nav2_single_trigger_bt_node\n      - nav2_goal_updated_controller_bt_node\n      - nav2_is_battery_low_condition_bt_node\n      - nav2_navigate_through_poses_action_bt_node\n      - nav2_navigate_to_pose_action_bt_node\n      - nav2_remove_passed_goals_action_bt_node\n      - nav2_planner_selector_bt_node\n      - nav2_controller_selector_bt_node\n      - nav2_goal_checker_selector_bt_node\n      - nav2_controller_cancel_bt_node\n      - nav2_path_longer_on_approach_bt_node\n      - nav2_wait_cancel_bt_node\n      - nav2_spin_cancel_bt_node\n      - nav2_back_up_cancel_bt_node\n      - nav2_drive_on_heading_cancel_bt_node\n'})}),"\n",(0,t.jsxs)(n.admonition,{type:"info",children:[(0,t.jsxs)(n.p,{children:["The behavior of this node is defined by the XML file dubbed ",(0,t.jsx)(n.code,{children:"behavior.xml"})," which contains the behavior tree. This behavior tree includes when to call the path planner, when to call the controller, and when to activate a recovery behavior. More on behavior trees later on in this note."]}),(0,t.jsx)(n.p,{children:"behavior.xml"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'\x3c!--\n  This Behavior Tree replans the global path periodically at 1 Hz, and has\n  recovery actions. Obtained from the official Nav2 package\n--\x3e\n<root main_tree_to_execute="MainTree">\n  <BehaviorTree ID="MainTree">\n    <RecoveryNode number_of_retries="6" name="NavigateRecovery">\n      <PipelineSequence name="NavigateWithReplanning">\n        <RateController hz="1.0">\n          <RecoveryNode number_of_retries="1" name="ComputePathToPose">\n            <ComputePathToPose goal="{goal}" path="{path}" planner_id="GridBased"/>\n            <ClearEntireCostmap service_name="global_costmap/clear_entirely_global_costmap"/>\n          </RecoveryNode>\n        </RateController>\n        <RecoveryNode number_of_retries="1" name="FollowPath">\n          <FollowPath path="{path}" controller_id="FollowPath"/>\n          <ClearEntireCostmap service_name="local_costmap/clear_entirely_local_costmap"/>\n        </RecoveryNode>\n      </PipelineSequence>\n      <SequenceStar name="RecoveryActions">\n        <ClearEntireCostmap service_name="local_costmap/clear_entirely_local_costmap"/>\n        <ClearEntireCostmap service_name="global_costmap/clear_entirely_global_costmap"/>\n        <Spin spin_dist="1.57"/>\n        <Wait wait_duration="5"/>\n      </SequenceStar>\n    </RecoveryNode>\n  </BehaviorTree>\n</root>\n'})})]}),"\n",(0,t.jsx)(n.h3,{id:"recoveries-server",children:"Recoveries Server"}),"\n",(0,t.jsxs)(n.p,{children:["When a robot cannot find a valid path to the goal provided or gets stuck in the middle, we use recovery behaviors provided by recovery servers. These are simple predefined movements called via behavior trees. When the robot gets stuck, the ",(0,t.jsx)(n.code,{children:"bt_navigator"})," will call the ",(0,t.jsx)(n.code,{children:"recoverieS_server"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"To Launch Recovery Servers:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-py",children:"package='nav2_behaviors',\nexecutable='behavior_server', these in the ```config``` directory.\n<Tabs>\nname='behavior_server',\noutput='screen',\nparameters=[recovery_yaml]\n"})}),"\n",(0,t.jsx)(n.p,{children:"There are three recovery behaviors available in the Nav2 stack:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"spin"}),": performs an in-place rotation by a given angle"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"backup"}),": performs a linear translation by a given distance"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"wait"}),": brings the robot to a stationary state"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["We can indicate which one of these behaviors we want to load within the config file ",(0,t.jsx)(n.code,{children:"recovery_yaml"}),"."]}),"\n",(0,t.jsx)(n.h5,{id:"recovery_yaml",children:"recovery_yaml"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'behavior_server:\n  ros__parameters:\n    costmap_topic: local_costmap/costmap_raw\n    footprint_topic: local_costmap/published_footprint\n    cycle_frequency: 10.0\n    behavior_plugins: ["spin", "backup", "wait"]\n    spin:\n      plugin: "nav2_behaviors/Spin"\n    backup:\n      plugin: "nav2_behaviors/BackUp"\n    wait:\n      plugin: "nav2_behaviors/Wait"\n    global_frame: odom\n    robot_base_frame: base_link\n    transform_timeout: 0.1\n    use_sim_time: true\n    simulate_ahead_time: 2.0\n    max_rotational_vel: 1.0\n    min_rotational_vel: 0.4\n    rotational_acc_lim: 3.2\n'})}),"\n",(0,t.jsx)(n.h3,{id:"demo",children:"Demo"}),"\n",(0,t.jsxs)(n.p,{children:["We'll start by first creating a new package using our favorite CMake build system. We'll then create two directories: ",(0,t.jsx)(n.code,{children:"config"})," and ",(0,t.jsx)(n.code,{children:"launch"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"We then create these and place them in their respective directories."}),"\n",(0,t.jsxs)(h.A,{children:[(0,t.jsx)(_.A,{value:"pathplanner.launch.py",label:"pathplanner.launch.py",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-py",children:"from launch import LaunchDescription\nfrom launch_ros.actions import Node\nfrom ament_index_python.packages import get_package_share_directory\nimport os\n\ndef generate_launch_description():\n\n    planner_yaml = os.path.join(get_package_share_directory('path_planner_server'), 'config', 'planner.yaml')\n    controller_yaml = os.path.join(get_package_share_directory('path_planner_server'), 'config', 'controller.yaml')\n    recovery_yaml = os.path.join(get_package_share_directory('path_planner_server'), 'config', 'recovery.yaml')\n    bt_navigator_yaml = os.path.join(get_package_share_directory('path_planner_server'), 'config', 'bt_navigator.yaml')\n\n    return LaunchDescription([\n        Node(\n            package='nav2_planner',\n            executable='planner_server',\n            name='planner_server',\n            output='screen',\n            parameters=[planner_yaml]\n            ),\n        Node(\n            package='nav2_controller',\n            executable='controller_server',\n            name='controller_server',\n            output='screen', these in the ```config``` directory.\n\n<Tabs>                               these in the ```config``` directory.    \n<Tabs>                                                                                                                                                                \n            parameters=[controller_yaml],\n            ),\n        Node(\n            package='nav2_bt_navigator',\n            executable='bt_navigator',\n            name='bt_navigator',\n            output='screen',\n            parameters=[bt_navigator_yaml],\n            ),\n        Node(\n            package='nav2_behaviors',\n            executable='behavior_server',\n            name='behavior_server',\n            output='screen',\n            parameters=[recovery_yaml],\n            ),\n        Node(\n            package='nav2_lifecycle_manager',\n            executable='lifecycle_manager',\n            name='lifecycle_manager_pathplanner',\n            output='screen',\n            parameters=[{'autostart': True},\n                        {'node_names': ['planner_server', 'controller_server', 'behavior_server', 'bt_navigator']}],\n            )\n        ])\n\n"})})}),(0,t.jsx)(_.A,{value:"planner.yaml",label:"planner.yaml",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'planner_server:\n  ros__parameters:\n    expected_planner_frequency: 10.0\n    use_sim_time: True\n    planner_plugins: ["GridBased"]\n    GridBased:\n      plugin: "nav2_navfn_planner/NavfnPlanner"\n      tolerance: 0.5\n      use_astar: false\n      allow_unknown: true\n'})})}),(0,t.jsx)(_.A,{value:"controller.yaml",label:"controller.yaml",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'controller_server:\n  ros__parameters:\n    use_sim_time: True\n    controller_frequency: 10.0\n    min_x_velocity_threshold: 0.001\n    min_y_velocity_threshold: 0.5\n    min_theta_velocity_threshold: 0.001\n    failure_tolerance: 0.3\n    progress_checker_plugin: "progress_checker"\n    goal_checker_plugins: ["general_goal_checker"] \n    controller_plugins: ["FollowPath"]\n\n    progress_checker:\n      plugin: "nav2_controller::SimpleProgressChecker"\n      required_movement_radius: 0.5\n      movement_time_allowance: 10.0\n    general_goal_checker:\n      stateful: True\n      plugin: "nav2_controller::SimpleGoalChecker"\n      xy_goal_tolerance: 0.25\n      yaw_goal_tolerance: 0.25\n    FollowPath:\n      plugin: "dwb_core::DWBLocalPlanner"\n      debug_trajectory_details: True\n      min_vel_x: 0.0\n      min_vel_y: 0.0\n      max_vel_x: 0.26\n      max_vel_y: 0.0\n      max_vel_theta: 1.0\n      min_speed_xy: 0.0\n      max_speed_xy: 0.26\n      min_speed_theta: 0.0\n      acc_lim_x: 2.5\n      acc_lim_y: 0.0\n      acc_lim_theta: 3.2\n      decel_lim_x: -2.5\n      decel_lim_y: 0.0\n      decel_lim_theta: -3.2\n      vx_samples: 20\n      vy_samples: 5\n      vtheta_samples: 20\n      sim_time: 1.7\n      linear_granularity: 0.05\n      angular_granularity: 0.025\n      transform_tolerance: 0.2\n      xy_goal_tolerance: 0.25\n      trans_stopped_velocity: 0.25\n      short_circuit_trajectory_evaluation: True\n      stateful: True\n      critics: ["RotateToGoal", "Oscillation", "BaseObstacle", "GoalAlign", "PathAlign", "PathDist", "GoalDist"]\n      BaseObstacle.scale: 0.02\n      PathAlign.scale: 32.0\n      PathAlign.forward_point_distance: 0.1\n      GoalAlign.scale: 24.0\n      GoalAlign.forward_point_distance: 0.1\n      PathDist.scale: 32.0\n      GoalDist.scale: 24.0\n      RotateToGoal.scale: 32.0\n      RotateToGoal.slowing_factor: 5.0\n      RotateToGoal.lookahead_time: -1.0\n\n'})})}),(0,t.jsx)(_.A,{value:"bt_navigator.yaml",label:"bt_navigator.yaml",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'bt_navigator:\n  ros__parameters:\n    use_sim_time: True\n    global_frame: map\n    robot_base_frame: base_link\n    odom_topic: /odom\n    bt_loop_duration: 10\n    default_server_timeout: 20\n    default_nav_to_pose_bt_xml: "/home/user/ros2_ws/src/path_planner_server/config/behavior.xml"\n    plugin_lib_names:\n    - nav2_compute_path_to_pose_action_bt_node\n    - nav2_compute_path_through_poses_action_bt_node\n    - nav2_smooth_path_action_bt_node\n    - nav2_follow_path_action_bt_node\n    - nav2_spin_action_bt_node\n    - nav2_wait_action_bt_node\n    - nav2_back_up_action_bt_node\n    - nav2_drive_on_heading_bt_node\n    - nav2_clear_costmap_service_bt_node\n    - nav2_is_stuck_condition_bt_node\n    - nav2_goal_reached_condition_bt_node\n    - nav2_goal_updated_condition_bt_node\n    - nav2_globally_updated_goal_condition_bt_node\n    - nav2_is_path_valid_condition_bt_node\n    - nav2_initial_pose_received_condition_bt_node\n    - nav2_reinitialize_global_localization_service_bt_node\n    - nav2_rate_controller_bt_node\n    - nav2_distance_controller_bt_node\n    - nav2_speed_controller_bt_node\n    - nav2_truncate_path_action_bt_node\n    - nav2_truncate_path_local_action_bt_node\n    - nav2_goal_updater_node_bt_node\n    - nav2_recovery_node_bt_node\n    - nav2_pipeline_sequence_bt_node\n    - nav2_round_robin_node_bt_node\n    - nav2_transform_available_condition_bt_node\n    - nav2_time_expired_condition_bt_node\n    - nav2_path_expiring_timer_condition\n    - nav2_distance_traveled_condition_bt_node\n    - nav2_single_trigger_bt_node\n    - nav2_goal_updated_controller_bt_node\n    - nav2_is_battery_low_condition_bt_node\n    - nav2_navigate_through_poses_action_bt_node\n    - nav2_navigate_to_pose_action_bt_node\n    - nav2_remove_passed_goals_action_bt_node\n    - nav2_planner_selector_bt_node\n    - nav2_controller_selector_bt_node\n    - nav2_goal_checker_selector_bt_node\n    - nav2_controller_cancel_bt_node\n    - nav2_path_longer_on_approach_bt_node\n    - nav2_wait_cancel_bt_node\n    - nav2_spin_cancel_bt_node\n    - nav2_back_up_cancel_bt_node\n    - nav2_drive_on_heading_cancel_bt_node\n'})})}),(0,t.jsx)(_.A,{value:"recovery.yaml",label:"recovery.yaml",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'behavior_server:\n  ros__parameters:\n    costmap_topic: local_costmap/costmap_raw\n    footprint_topic: local_costmap/published_footprint\n    cycle_frequency: 10.0\n    behavior_plugins: ["spin", "backup", "wait"]\n    spin:\n      plugin: "nav2_behaviors/Spin"\n    backup:\n      plugin: "nav2_behaviors/BackUp"\n    wait:\n      plugin: "nav2_behaviors/Wait"\n    global_frame: odom\n    robot_base_frame: base_link\n    transform_timeout: 0.1\n    use_sim_time: true\n    simulate_ahead_time: 2.0\n    max_rotational_vel: 1.0\n    min_rotational_vel: 0.4\n    rotational_acc_lim: 3.2\n'})})}),(0,t.jsx)(_.A,{value:"behavior.xml",label:"behavior.xml",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-xml",children:'\x3c!--\n  This Behavior Tree replans the global path periodically at 1 Hz, and has\n  recovery actions. Obtained from the official Nav2 package\n--\x3e\n<root main_tree_to_execute="MainTree">\n  <BehaviorTree ID="MainTree">\n    <RecoveryNode number_of_retries="6" name="NavigateRecovery">\n      <PipelineSequence name="NavigateWithReplanning">\n        <RateController hz="1.0">\n          <RecoveryNode number_of_retries="1" name="ComputePathToPose">\n            <ComputePathToPose goal="{goal}" path="{path}" planner_id="GridBased"/>                               \n            <ClearEntireCostmap service_name="global_costmap/clear_entirely_global_costmap"/>\n          </RecoveryNode>\n        </RateController>\n        <RecoveryNode number_of_retries="1" name="FollowPath">\n          <FollowPath path="{path}" controller_id="FollowPath"/>\n          <ClearEntireCostmap service_name="local_costmap/clear_entirely_local_costmap"/>\n        </RecoveryNode>\n      </PipelineSequence>\n      <SequenceStar name="RecoveryActions">\n        <ClearEntireCostmap service_name="local_costmap/clear_entirely_local_costmap"/>\n        <ClearEntireCostmap service_name="global_costmap/clear_entirely_global_costmap"/>\n        <Spin spin_dist="1.57"/>\n        <Wait wait_duration="5"/>\n      </SequenceStar>\n    </RecoveryNode>\n  </BehaviorTree>\n</root>\n'})})})]}),"\n",(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsx)(n.p,{children:"We have to be running in parallel our localization server, the one responsible for localizing our robot with the map and the one providing the base map environment."})}),"\n",(0,t.jsx)(n.h4,{id:"rviz2-settings",children:"RVIZ2 Settings"}),"\n",(0,t.jsxs)(n.p,{children:["On top of our settings provided for localization, we add the ",(0,t.jsx)(n.code,{children:"Path"})," display and change LineStyle to ",(0,t.jsx)(n.code,{children:"BillBoards"}),". If everything is set, we can get something cool like below!"]}),"\n",(0,t.jsx)("iframe",{width:"100%",height:"650px",src:m,allow:"accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowfullscreen:!0,title:"Demo Video",children:" "}),"\n",(0,t.jsx)(n.h4,{id:"navigation-goal-via-cli",children:"Navigation Goal via CLI"}),"\n",(0,t.jsxs)(n.p,{children:["We can send a goal via the CLI through the server interface ",(0,t.jsx)(n.code,{children:"/navigate_to_pose"})," or ",(0,t.jsx)(n.code,{children:"goal_pose"}),"."]}),"\n",(0,t.jsx)(n.h5,{id:"action",children:"Action"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'ros2 action send_goal /navigate_to_pose nav2_msgs/action/NavigateToPose "pose: {header: {frame_id: map}, pose: {position: {x: 1.52, y: 1.92, z: 0.0}, orientation:{x: 0.0, y: 0.0, z: 0, w: 1.0000000}}}"\n'})}),"\n",(0,t.jsx)(n.h5,{id:"topic",children:"Topic"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"ros2 topic pub -1 /goal_pose geometry_msgs/PoseStamped \"{header: {stamp: {sec: 0}, frame_id: 'map'}, pose: {position: {x: 2.2, y: 0.0, z: 0.0}, orientation: {w: 1.0}}}\"\n"})}),"\n",(0,t.jsx)(n.h4,{id:"ros2-node",children:"ROS2 Node"}),"\n",(0,t.jsx)(n.p,{children:"Taken directly from The Construct."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-py",children:"import rclpy\nfrom nav2_msgs.action import NavigateToPose\nfrom rclpy.action import ActionClient\nfrom rclpy.node import Node\nfrom geometry_msgs.msg import PointStamped\n\nclass NavToPoseActionClient(Node):\n\n    def __init__(self):\n        super().__init__('Nav_To_Pose_Action_Client')\n        self._action_client = ActionClient(self, NavigateToPose, '/navigate_to_pose')\n        self.subscriber_ = self.create_subscription(PointStamped, 'clicked_point', self.callback, 1)\n        self.subscriber_  # prevent unused variable warning\n\n    def callback(self, msg):\n        self.get_logger().info('Recieved Data:\\n X : %f \\n Y : %f \\n Z : %f' % (msg.point.x, msg.point.y, msg.point.z))\n        self.send_goal (msg.point.x, msg.point.y, 0.0)\n\n    def send_goal(self, x ,y, theta):\n        self.get_logger().info('sending goal to action server')\n        goal_pose = NavigateToPose.Goal()\n        goal_pose.pose.header.frame_id = 'map'\n        goal_pose.pose.pose.position.x = x\n        goal_pose.pose.pose.position.y = y\n        goal_pose.pose.pose.position.z = theta\n\n        self.get_logger().info('waiting for action server')\n        self._action_client.wait_for_server()\n        self.get_logger().info('action server detected')\n\n        self._send_goal_future = self._action_client.send_goal_async(\n            goal_pose,\n            feedback_callback=self.feedback_callback)\n        self.get_logger().info('goal sent')\n\n        self._send_goal_future.add_done_callback(self.goal_response_callback)\n\n    def goal_response_callback(self, future):\n        goal_handle = future.result()\n        if not goal_handle.accepted:\n            self.get_logger().info('Goal rejected :(')\n            return\n        self.get_logger().info('Goal accepted :)')\n        self._get_result_future = goal_handle.get_result_async()\n\n        self._get_result_future.add_done_callback(self.get_result_callback)\n\n    def get_result_callback(self, future):\n        result = future.result().result\n        self.get_logger().info('Result: {0}' + str(result))\n        rclpy.shutdown()\n\n    def feedback_callback(self, feedback_msg):\n        feedback = feedback_msg.feedback\n        self.get_logger().info('FEEDBACK:' + str(feedback) )\n\ndef main(args=None):\n    rclpy.init(args=args)\n\n    action_client = NavToPoseActionClient()\n\n    rclpy.spin(action_client)\n\n\nif __name__ == '__main__':\n    main()\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Used via RVIZ and ",(0,t.jsx)(n.code,{children:"Publish Point"})," feature."]}),"\n",(0,t.jsx)(n.h2,{id:"obstacle-avoidance",children:"Obstacle Avoidance"}),"\n",(0,t.jsx)(n.p,{children:"The Nav2 stack avoids dynamic and static obstacles by utilizing what's known as costmaps."}),"\n",(0,t.jsx)(n.h3,{id:"costmaps",children:"Costmaps"}),"\n",(0,t.jsx)(n.p,{children:"A Costmap is a 2D representation of robot-sensed obstacles on a grid map. Each grid cells contain information about the obstacles detected by the sensors. The cost of the cell can be unknown, free, occupied, or inflated. Different colors indicate how likely it is to colide against an obstacle. Using this information, the Nav2 stack can compute their tasks safely and efficiently."}),"\n",(0,t.jsxs)(n.p,{children:["There are two kinds of costmaps: ",(0,t.jsx)(n.code,{children:"global"})," and ",(0,t.jsx)(n.code,{children:"local"}),"."]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"global"}),": generated from obstacles on a static map and is used by the ",(0,t.jsx)(n.code,{children:"planner"})," to generate long term path."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"local"}),": created from new obstacles during runtime(sensors) and is used by the ",(0,t.jsx)(n.code,{children:"controller"})," to generate short-term path"]}),"\n"]}),"\n",(0,t.jsx)("img",{src:u().src,width:"100%"}),"\n",(0,t.jsx)(n.h3,{id:"global-costmaps",children:"Global Costmaps"}),"\n",(0,t.jsxs)(n.p,{children:["To add a ",(0,t.jsx)(n.code,{children:"global costmap"}),", we can add these parameters to the ",(0,t.jsx)(n.code,{children:"planner.yaml"})," file."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'global_costmap:\n  global_costmap:\n    ros__parameters:\n      update_frequency: 1.0\n      publish_frequency: 1.0\n      global_frame: map\n      robot_base_frame: base_link\n      use_sim_time: True\n      robot_radius: 0.15\n      resolution: 0.05\n      track_unknown_space: true\n      plugins: ["static_layer", "inflation_layer"]\n      static_layer:\n        plugin: "nav2_costmap_2d::StaticLayer"\n        map_subscribe_transient_local: True\n      inflation_layer:\n        plugin: "nav2_costmap_2d::InflationLayer"\n        cost_scaling_factor: 3.0\n        inflation_radius: 0.35\n      always_send_full_costmap: True\n'})}),"\n",(0,t.jsxs)(n.p,{children:["When we run our ",(0,t.jsx)(n.code,{children:"path_planner_server"})," with these new parameters, we see an added map on top of our base map. When we add a new obstacle, the global costmap is not updated. The differences can be seen below. This means that our planner will not take into consideration the new dynamic obstacle that spawned in and will crash."]}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsx)(n.p,{children:"The different tones of gray are to illustrate the different regions the robot can use. Dark tones of grey means the robot cannot use that area to path plan as it is too close to an obstacle"})}),"\n",(0,t.jsx)(n.h4,{id:"global-costmap-obstacle-layers",children:"Global Costmap Obstacle Layers"}),"\n",(0,t.jsxs)(n.p,{children:["Global costmaps are generated as the superposition of different obstacle layers. This means that each layer adds a set of obstacles to the ",(0,t.jsx)(n.code,{children:"global costmap"})," based on how the layer computes the obstacles."]}),"\n",(0,t.jsx)(n.p,{children:"Available Costmap layers:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Static Layer"}),": Adds as obstacles to the ",(0,t.jsx)(n.code,{children:"global costmap"})," any black dot that exists in the static map"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Inflation Layer"}),": Adds an inflation to any obstacle in the ",(0,t.jsx)(n.code,{children:"global costmap"}),", as a safe distance to maintain"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Obstacle Layer"}),": Adds to the ",(0,t.jsx)(n.code,{children:"global costmap"})," any object detected by a 2D sensor"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Voxel Layer"}),": Adds to the ",(0,t.jsx)(n.code,{children:"global costmap"})," 3D obstacles from PointCloud data."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"We can specify which layers or all in our parameter list via plugins."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'plugins: ["static_layer", "obstacle_layer", "inflation_layer", "voxel_layer"] # Order matters here, inflation is applied after obstacle, etc.\n'})}),"\n",(0,t.jsx)(n.p,{children:"Adding these layers will allow us to account for dynamic obstacles."}),"\n",(0,t.jsx)(n.h4,{id:"general-parameters",children:"General Parameters"}),"\n",(0,t.jsxs)(h.A,{children:[(0,t.jsx)(_.A,{value:"global_costmap",label:"global_costmap",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'global_costmap:\n  global_costmap:\n    ros__parameters:\n      update_frequency: 1.0\n      publish_frequency: 1.0\n      global_frame: map\n      robot_base_frame: base_link\n      use_sim_time: True\n      robot_radius: 0.15\n      resolution: 0.05\n      track_unknown_space: true\n      plugins: ["static_layer", "obstacle_layer", "inflation_layer"]\n'})})}),(0,t.jsx)(_.A,{value:"static_layer",label:"static_layer",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'static_layer: plugin: "nav2_costmap_2d::StaticLayer"',children:'map_subscribe_transient_local: True ```\n</TabItem>\n\n<TabItem value="inflation_layer" label="inflation_layer">\n```yaml inflation_layer: plugin: "nav2_costmap_2d::InflationLayer"\ncost_scaling_factor: 3.0 inflation_radius: 0.35 ```\n</TabItem>\n\n<TabItem value="obstacle_layer" label="obstacle_layer">\n```yaml obstacle_layer: plugin: "nav2_costmap_2d::ObstacleLayer" enabled: True\nobservation_sources: scan scan: topic: /scan max_obstacle_height: 2.0\nclearing: True marking: True data_type: "LaserScan" raytrace_max_range: 3.0\nraytrace_min_range: 0.0 obstacle_max_range: 2.5 obstacle_min_range: 0.0 ```\n</TabItem>\n\n<TabItem value="voxel_layer" label="voxel_layer">\n```yaml\nvoxel_layer:\nplugin: "nav2_costmap_2d::VoxelLayer"\nenabled: True\nfootprint_clearing_enabled: true\nmax_obstacle_height: 2.0\npublish_voxel_map: True\norigin_z: 0.0\nz_resolution: 0.05\nz_voxels: 16\nmax_obstacle_height: 2.0\nunknown_threshold: 15\nmark_threshold: 0\nobservation_sources: pointcloud\ncombination_method: 1\npointcloud:  # no frame set, uses frame from message\n  topic: /intel_realsense_r200_depth/points\n  max_obstacle_height: 2.0\n  min_obstacle_height: 0.0\n  obstacle_max_range: 2.5\n  obstacle_min_range: 0.0\n  raytrace_max_range: 3.0\n  raytrace_min_range: 0.0\n  clearing: True\n  marking: True\n  data_type: "PointCloud2"\n'})})})]}),"\n",(0,t.jsx)(n.h3,{id:"local-costmap",children:"Local Costmap"}),"\n",(0,t.jsxs)(n.p,{children:["Let's figure out how to add a ",(0,t.jsx)(n.code,{children:"local costmap"}),". It's no different than a ",(0,t.jsx)(n.code,{children:"global costmap"})," but goes inside of ",(0,t.jsx)(n.code,{children:"controller.yaml"})," instead of ",(0,t.jsx)(n.code,{children:"planner.yaml"}),". This is because a ",(0,t.jsx)(n.code,{children:"local costmap"})," is a dynamic version of the ",(0,t.jsx)(n.code,{children:"global costmap"})," using sensors."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'local_costmap:\n  local_costmap:\n    ros__parameters:\n      update_frequency: 5.0\n      publish_frequency: 2.0\n      global_frame: odom\n      robot_base_frame: base_link\n      use_sim_time: True\n      rolling_window: true\n      width: 1\n      height: 1\n      resolution: 0.05\n      robot_radius: 0.15\n      plugins: ["voxel_layer", "inflation_layer"]\n      inflation_layer:\n        plugin: "nav2_costmap_2d::InflationLayer"\n        cost_scaling_factor: 3.0\n        inflation_radius: 0.35\n      voxel_layer:\n        plugin: "nav2_costmap_2d::VoxelLayer"\n        enabled: True\n        publish_voxel_map: True\n        origin_z: 0.0\n        z_resolution: 0.05\n        z_voxels: 16\n        max_obstacle_height: 2.0\n        mark_threshold: 0\n        observation_sources: scan\n        scan:\n          topic: /scan\n          max_obstacle_height: 2.0\n          clearing: True\n          marking: True\n          data_type: "LaserScan"\n          raytrace_max_range: 3.0\n          raytrace_min_range: 0.0\n          obstacle_max_range: 2.5\n          obstacle_min_range: 0.0\n      static_layer:\n        map_subscribe_transient_local: True\n      always_send_full_costmap: True\n'})})]})}function f(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(b,{...e})}):b(e)}},7227:(e,n,a)=>{"use strict";a.d(n,{A:()=>s});a(6540);var r=a(4164);const t={tabItem:"tabItem_Ymn6"};var i=a(4848);function s(e){let{children:n,hidden:a,className:s}=e;return(0,i.jsx)("div",{role:"tabpanel",className:(0,r.A)(t.tabItem,s),hidden:a,children:n})}},9489:(e,n,a)=>{"use strict";a.d(n,{A:()=>y});var r=a(6540),t=a(4164),i=a(4245),s=a(6347),o=a(6494),l=a(2814),c=a(5167),d=a(9900);function h(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function _(e){const{values:n,children:a}=e;return(0,r.useMemo)((()=>{const e=n??function(e){return h(e).map((e=>{let{props:{value:n,label:a,attributes:r,default:t}}=e;return{value:n,label:a,attributes:r,default:t}}))}(a);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,a])}function m(e){let{value:n,tabValues:a}=e;return a.some((e=>e.value===n))}function p(e){let{queryString:n=!1,groupId:a}=e;const t=(0,s.W6)(),i=function(e){let{queryString:n=!1,groupId:a}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!a)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return a??null}({queryString:n,groupId:a});return[(0,l.aZ)(i),(0,r.useCallback)((e=>{if(!i)return;const n=new URLSearchParams(t.location.search);n.set(i,e),t.replace({...t.location,search:n.toString()})}),[i,t])]}function u(e){const{defaultValue:n,queryString:a=!1,groupId:t}=e,i=_(e),[s,l]=(0,r.useState)((()=>function(e){let{defaultValue:n,tabValues:a}=e;if(0===a.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!m({value:n,tabValues:a}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${a.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const r=a.find((e=>e.default))??a[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:i}))),[c,h]=p({queryString:a,groupId:t}),[u,x]=function(e){let{groupId:n}=e;const a=function(e){return e?`docusaurus.tab.${e}`:null}(n),[t,i]=(0,d.Dv)(a);return[t,(0,r.useCallback)((e=>{a&&i.set(e)}),[a,i])]}({groupId:t}),g=(()=>{const e=c??u;return m({value:e,tabValues:i})?e:null})();(0,o.A)((()=>{g&&l(g)}),[g]);return{selectedValue:s,selectValue:(0,r.useCallback)((e=>{if(!m({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);l(e),h(e),x(e)}),[h,x,i]),tabValues:i}}var x=a(1062);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var j=a(4848);function v(e){let{className:n,block:a,selectedValue:r,selectValue:s,tabValues:o}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,i.a_)(),d=e=>{const n=e.currentTarget,a=l.indexOf(n),t=o[a].value;t!==r&&(c(n),s(t))},h=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const a=l.indexOf(e.currentTarget)+1;n=l[a]??l[0];break}case"ArrowLeft":{const a=l.indexOf(e.currentTarget)-1;n=l[a]??l[l.length-1];break}}n?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,t.A)("tabs",{"tabs--block":a},n),children:o.map((e=>{let{value:n,label:a,attributes:i}=e;return(0,j.jsx)("li",{role:"tab",tabIndex:r===n?0:-1,"aria-selected":r===n,ref:e=>l.push(e),onKeyDown:h,onClick:d,...i,className:(0,t.A)("tabs__item",g.tabItem,i?.className,{"tabs__item--active":r===n}),children:a??n},n)}))})}function b(e){let{lazy:n,children:a,selectedValue:i}=e;const s=(Array.isArray(a)?a:[a]).filter(Boolean);if(n){const e=s.find((e=>e.props.value===i));return e?(0,r.cloneElement)(e,{className:(0,t.A)("margin-top--md",e.props.className)}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:s.map(((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==i})))})}function f(e){const n=u(e);return(0,j.jsxs)("div",{className:(0,t.A)("tabs-container",g.tabList),children:[(0,j.jsx)(v,{...n,...e}),(0,j.jsx)(b,{...n,...e})]})}function y(e){const n=(0,x.A)();return(0,j.jsx)(f,{...e,children:h(e.children)},String(n))}},8453:(e,n,a)=>{"use strict";a.d(n,{R:()=>s,x:()=>o});var r=a(6540);const t={},i=r.createContext(t);function s(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);